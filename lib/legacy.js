"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var escape=_interopDefault(require("lodash.escape")),JSZip=_interopDefault(require("jszip"));const CELL_TYPE_STRING="string",CELL_TYPE_NUMBER="number",validTypes=["string","number"],MISSING_KEY_FILENAME="Zipclex config missing property filename",INVALID_TYPE_FILENAME="Zipclex filename can only be of type string",INVALID_TYPE_SHEET="Zipcelx sheet data is not of type array",INVALID_TYPE_SHEET_DATA="Zipclex sheet data childs is not of type array",WARNING_INVALID_TYPE='Invalid type supplied in cell config, falling back to "string"',childValidator=e=>e.every(e=>Array.isArray(e));var validator=e=>e.filename?"string"!=typeof e.filename?(console.error(INVALID_TYPE_FILENAME),!1):Array.isArray(e.sheet.data)?!!childValidator(e.sheet.data)||(console.error(INVALID_TYPE_SHEET_DATA),!1):(console.error(INVALID_TYPE_SHEET),!1):(console.error(MISSING_KEY_FILENAME),!1);const generateColumnLetter=e=>{if("number"!=typeof e)return"";const t=Math.floor(e/26),o=String.fromCharCode(97+e%26).toUpperCase();return 0===t?o:generateColumnLetter(t-1)+o};var generatorCellNumber=(e,t)=>`${generateColumnLetter(e)}${t}`,generatorStringCell=(e,t,o,l)=>{let n=`<c r="${generatorCellNumber(e,o)}"`;return l&&(n+=` s="${l}"`),n+=` t="inlineStr"><is><t>${escape(t)}</t></is></c>`},generatorNumberCell=(e,t,o,l)=>{let n=`<c r="${generatorCellNumber(e,o)}"`;return l&&(n+=` s="${l}"`),n+=`><v>${t}</v></c>`},formatCell=(e,t,o,l)=>(-1===validTypes.indexOf(e.type)&&(console.warn(WARNING_INVALID_TYPE),e.type="string"),"string"===e.type?generatorStringCell(t,e.value,o,e.style?e.style.toString():""):generatorNumberCell(t,e.value,o,e.style?e.style.toString():"")),formatRow=(e,t,o)=>{const l=t+1,n=e.map((e,t)=>formatCell(e,t,l,o)).join("");return`<row r="${l}">${n}</row>`},generatorRows=(e,t)=>e.map((e,o)=>formatRow(e,o,t)).join(""),Truncate=e=>Math.trunc?Math.trunc(e):isNaN(e)?NaN:e>0?Math.floor(e):Math.ceil(e),formatCol=(e,t)=>{if(!e.width)return"";const o=t+1,l=Truncate((e.width-5)/6*100+.5)/100;return`<col min="${o}" max="${o}" width="${Truncate((6*l+5)/6*256)/256}" />`},generatorCols=e=>{const t=e&&e.map((e,t)=>formatCol(e,t)).join("");return t?`<cols>${t}</cols>`:""},workbookXML='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mx="http://schemas.microsoft.com/office/mac/excel/2008/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mv="urn:schemas-microsoft-com:mac:vml" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xm="http://schemas.microsoft.com/office/excel/2006/main"><workbookPr/><sheets><sheet state="visible" name="Sheet1" sheetId="1" r:id="rId3"/></sheets><definedNames/><calcPr/></workbook>',workbookXMLRels='<?xml version="1.0" ?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n<Relationship Id="rId3" Target="worksheets/sheet1.xml" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet"/>\n<Relationship Id="rId4" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml" />\n</Relationships>',rels='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',contentTypes='<?xml version="1.0" ?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n<Default ContentType="application/xml" Extension="xml"/>\n<Default ContentType="application/vnd.openxmlformats-package.relationships+xml" Extension="rels"/>\n<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml" PartName="/xl/worksheets/sheet1.xml"/>\n<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml" PartName="/xl/workbook.xml"/>\n<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml" PartName="/xl/styles.xml"/>\n</Types>',templateSheet='<?xml version="1.0" ?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mv="urn:schemas-microsoft-com:mac:vml" xmlns:mx="http://schemas.microsoft.com/office/mac/excel/2008/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xm="http://schemas.microsoft.com/office/excel/2006/main">{colsPlaceholder}<sheetData>{placeholder}</sheetData></worksheet>',styleTemplate='<?xml version="1.0" encoding="utf-8" standalone="yes"?>\n<styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac">{placeholder}</styleSheet>',styleInnerTemplate='\n<fonts count="1" x14ac:knownFonts="1">\n    <font>\n        <sz val="11"/>\n        <color theme="1"/>\n        <name val="Calibri"/>\n        <family val="2"/>\n        <scheme val="minor"/>\n    </font>\n</fonts>\n<fills count="2">\n    <fill>\n        <patternFill patternType="none"/>\n    </fill>\n    <fill>\n        <patternFill patternType="gray125"/>\n    </fill>\n</fills>\n<borders count="1">\n    <border>\n        <left/>\n        <right/>\n        <top/>\n        <bottom/>\n        <diagonal/>\n    </border>\n</borders>\n<cellStyleXfs count="1">\n    <xf numFmtId="0" fontId="0" fillId="0" borderId="0"/>\n</cellStyleXfs>\n<cellXfs count="2">\n    <xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0"/>\n    <xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" applyAlignment="1">\n        <alignment wrapText="1"/>\n    </xf>\n</cellXfs>\n<cellStyles count="1">\n    <cellStyle name="Normal" xfId="0" builtinId="0"/>\n</cellStyles>\n<dxfs count="0"/>\n<tableStyles count="0" defaultTableStyle="TableStyleMedium2" defaultPivotStyle="PivotStyleLight16"/>\n<extLst>\n    <ext uri="{EB79DEF2-80B8-43e5-95BD-54CBDDF9020C}"\n         xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main">\n        <x14:slicerStyles defaultSlicerStyle="SlicerStyleLight1"/>\n    </ext>\n    <ext uri="{9260A510-F301-46a8-8635-F512D64BE5F5}"\n         xmlns:x15="http://schemas.microsoft.com/office/spreadsheetml/2010/11/main">\n        <x15:timelineStyles defaultTimelineStyle="TimeSlicerStyleLight1"/>\n    </ext>\n</extLst>';const generateXMLWorksheet=(e,t,o)=>{const l=generatorRows(e,o),n=generatorCols(t);return templateSheet.replace("{placeholder}",l).replace("{colsPlaceholder}",n)};var zipcelx=e=>{if(!validator(e))throw new Error("Validation failed.");const t=new JSZip,o=t.folder("xl");o.file("workbook.xml",workbookXML),o.file("_rels/workbook.xml.rels",workbookXMLRels),t.file("_rels/.rels",rels),t.file("[Content_Types].xml",contentTypes);const l=[],n=generateXMLWorksheet(e.sheet.data,e.sheet.cols,l);o.file("worksheets/sheet1.xml",n);const s=[];for(let e=0;e<l.length;e++)if(l[e].indexOf("bgColor=")>-1){const t=l[e].indexOf('"',l[e].indexOf("bgColor=")),o=l[e].indexOf('"',t+1),n=l[e].substring(t+1,o);s.push(n)}let r=`<fills count="${s.length+2}"><fill /><fill><patternFill patternType="gray125"/></fill>`;for(let e=0;e<s.length;e++)r+=`<fill><patternFill patternType="solid"><fgColor indexed="${e}"/></patternFill></fill>`;r+="</fills>";const a=styleInnerTemplate.replace("{fillsPlaceholder}",r),i=styleTemplate.replace("{placeholder}",a);return o.file("styles.xml",i),t.generateAsync({type:"nodebuffer"}).then(e=>e)};exports.generateXMLWorksheet=generateXMLWorksheet,exports.default=zipcelx;
